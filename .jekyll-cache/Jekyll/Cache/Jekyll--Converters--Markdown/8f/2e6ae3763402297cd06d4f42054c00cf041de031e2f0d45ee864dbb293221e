I"]1<h2 id="update-pay-attention">Update, Pay Attention!</h2>

<h4 id="bad-news">Bad News</h4>
<p>As of version <code class="language-plaintext highlighter-rouge">6.78</code> things began to change, first the developers removed the upload feature, and the <code class="language-plaintext highlighter-rouge">wp-cli</code> functionality. Newer versions of the plugin are really stripped down and include less functionality than <code class="language-plaintext highlighter-rouge">6.77</code> did. The new version exists on the Wordpress repository almost exclusively to upsell you to the paid version. The new plugin is still hackable, but there are more steps required than what’s described below, and like I said, it doesn’t work with <code class="language-plaintext highlighter-rouge">wp-cli</code>. The steps below to increase the plugin size don’t work on the new version.</p>

<h4 id="good-news">Good News</h4>
<p>Use this <a href="https://github.com/d0n601/All-In-One-WP-Migration-With-Import">https://github.com/d0n601/All-In-One-WP-Migration-With-Import</a> if you’d like. I’ve increased the upload size limit to 32 GB, it works on the current version of Wordpress, and it also includes <code class="language-plaintext highlighter-rouge">wp-cli</code> functionality. Just download it as a <a href="https://github.com/d0n601/All-In-One-WP-Migration-With-Import/archive/master.zip">zip</a> and upload it manually.</p>

<h2 id="original-article-below">Original Article Below</h2>

<p>A WordPress development workflow can be difficult to optimize, especially when working in a team environment. You wont have trouble finding a few well written articles online concerning version control setups and project structures. Setting up a new project is smooth when you’re using a Git repository of some flavor for your theme content, and <a title="Database Sync WordPress Plugin" href="https://wordpress.org/plugins/database-sync/" target="_blank">Database Sync</a> or a similar plugin to sync your local and live databases.</p>

<h4 id="what-about-the-case-in-which-you-inherit-an-existing-wordpress-site">What about the case in which you inherit an existing WordPress site?</h4>

<p>It’s not uncommon to need to pull all of a site’s plugins, settings, and media content to a local development environment at least initially. This is typically part of our “on boarding” process at work.</p>

<p>Simply syncing themes and databases as you typically would in your development workflow is not enough in this instance. With a plugin known as <a title="All in One WP Migration Plugin" href="https://wordpress.org/plugins/all-in-one-wp-migration/" target="_blank">All-in-One WP Migration</a>, you’re able to export an entire WordPress instance to a single file with an extension .wpress. You’re then able to turn right back around and import that file to another WordPress installation to create a clone.</p>

<p>Here is what the steps look like to export a production site to a file.</p>

<p><a href="/wp-content/uploads/2015/04/wpmigration1.png"><img class="aligncenter wp-image-73" title="WordPress All-in-One WP plugin " src="/wp-content/uploads/2015/04/wpmigration1.png" alt="WordPress All-in-One WP plugin Migration Step 1" width="400" height="242" srcset="/wp-content/uploads/2015/04/wpmigration1.png 929w, /wp-content/uploads/2015/04/wpmigration1-300x181.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a> <a href="/wp-content/uploads/2015/04/wpmigration2.png"><img class="aligncenter wp-image-74" title="WordPress All-in-One WP plugin Step 2" src="/wp-content/uploads/2015/04/wpmigration2.png" alt="All-in-One WP Step 2" width="400" height="248" srcset="/wp-content/uploads/2015/04/wpmigration2.png 765w, /wp-content/uploads/2015/04/wpmigration2-300x186.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a> <a href="/wp-content/uploads/2015/04/wpmigration3.png"><img class="aligncenter wp-image-75" src="/wp-content/uploads/2015/04/wpmigration3.png" alt="wpmigration3" width="400" height="200" srcset="/wp-content/uploads/2015/04/wpmigration3.png 521w, /wp-content/uploads/2015/04/wpmigration3-300x150.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p>At this point, depending upon the size of the backed up file, a blank installation of WordPress may be all that’s necessary to clone the production site.</p>

<p><a href="/wp-content/uploads/2015/04/wpmigration4.png"><img class="aligncenter wp-image-81" src="/wp-content/uploads/2015/04/wpmigration4.png" alt="wpmigration4" width="400" height="286" srcset="/wp-content/uploads/2015/04/wpmigration4.png 1278w, /wp-content/uploads/2015/04/wpmigration4-300x215.png 300w, /wp-content/uploads/2015/04/wpmigration4-1024x733.png 1024w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p>If the size of your .wpress file exceeds 512MB, you will be prompted to purchase the <a title="WordPress All In One Migration Unlimited Extension" href="https://servmask.com/products/unlimited-extension" target="_blank">Unlimited Extension of All-in-One WP Migration</a>.  If you’re inheriting a site that’s been in production for a while, it’s likely that the backup file is over this small size limit (see a fix for this below).</p>

<p><a href="/wp-content/uploads/2015/04/wpmigration7.png"><img class="aligncenter wp-image-83" src="/wp-content/uploads/2015/04/wpmigration7.png" alt="wpmigration7" width="400" height="267" srcset="/wp-content/uploads/2015/04/wpmigration7.png 584w, /wp-content/uploads/2015/04/wpmigration7-300x200.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p><a href="/wp-content/uploads/2015/04/wpmigration6.png"><img class="aligncenter wp-image-82 size-medium" src="/wp-content/uploads/2015/04/wpmigration6-300x90.png" alt="wpmigration6" width="300" height="90" srcset="/wp-content/uploads/2015/04/wpmigration6-300x90.png 300w, /wp-content/uploads/2015/04/wpmigration6.png 402w" sizes="(max-width: 300px) 100vw, 300px" /></a></p>

<p>Hacking the plugin seemed like a reasonable thing to try before making the $59 dollar purchase of the Unlimited Extension (which comes with lifetime updates, and unlimited support).</p>

<p>Go ahead and open up <code class="language-plaintext highlighter-rouge">/wp-content/plugins/all-in-one-wp-migration/constants.php</code></p>

<p>Search for “Max File Size” with a simple control + f, and you’ll be directed to the bit of code below.</p>

<h3 id="updated-july-20th-2018">Updated July 20th 2018</h3>
<p>As of version 6.72, the line that defines the file upload limit is line 289 of constants.php. The <code class="language-plaintext highlighter-rouge">2 &lt;&lt; 28</code> is the php <a href="http://php.net/manual/en/language.operators.bitwise.php">bitwise shift left</a> operation, resulting in <code class="language-plaintext highlighter-rouge">536870912</code> , which is 512MB. You can see the changes made to constants.php between version 6.71 and 6.72 <a href="https://plugins.trac.wordpress.org/changeset/1909788/all-in-one-wp-migration/trunk/constants.php?old=1904111&amp;old_path=all-in-one-wp-migration%2Ftrunk%2Fconstants.php">here</a>. These changes aren’t mentioned in the changelog at all, they seem to be an attempt at adding a little “security through obscurity” in order to prevent people from quickly spotting and applying this hack.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// =================</span>
<span class="c1">// = Max File Size =</span>
<span class="c1">// =================</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'AI1WM_MAX_FILE_SIZE'</span><span class="p">,</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span> <span class="p">);</span>
</code></pre></div></div>

<p>Older versions of the plugin (6.71 and below) simply defined the file upload size limit, in bytes, without using the shift operation. Either way though, increasing this limit is extremely easy.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// =================</span>
<span class="c1">// = Max File Size =</span>
<span class="c1">// =================</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'AI1WM_MAX_FILE_SIZE'</span><span class="p">,</span> <span class="mi">536870912</span> <span class="p">);</span>
</code></pre></div></div>

<p>In order to increase the upload size limit to 4GB, on all versions of the plugin, simply input the number of bytes as the <code class="language-plaintext highlighter-rouge">AI1WM_MAX_FILE_SIZE</code> constant. See below</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// =================</span>
<span class="c1">// = Max File Size =</span>
<span class="c1">// =================</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'AI1WM_MAX_FILE_SIZE'</span><span class="p">,</span> <span class="mi">4294967296</span> <span class="p">);</span> <span class="c1">// THIS LINE MAKES NEW LIMIT 4GB</span>
</code></pre></div></div>

<p>For the sake of demonstration, let’s set the limit even higher.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// =================</span>
<span class="c1">// = Max File Size =</span>
<span class="c1">// =================</span>
<span class="nb">define</span><span class="p">(</span> <span class="s1">'AI1WM_MAX_FILE_SIZE'</span><span class="p">,</span> <span class="mi">4294967296</span> <span class="o">*</span> <span class="mi">10</span> <span class="p">);</span> <span class="c1">// THIS LINE MAKES NEW LIMIT 40GB</span>
</code></pre></div></div>

<p>Save the file and navigate back to the “import” function for the All-In-One Migration Plugin. The file upload limit now reads 4GB.</p>

<p><a href="/wp-content/uploads/2015/04/wpmigration8.png"><img class="aligncenter wp-image-89" src="/wp-content/uploads/2015/04/wpmigration8.png" alt="wpmigration8" width="400" height="197" srcset="/wp-content/uploads/2015/04/wpmigration8.png 406w, /wp-content/uploads/2015/04/wpmigration8-300x148.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p>The plugin will no longer reject your large file uploads.</p>

<p><a href="/wp-content/uploads/2015/04/wpmigration9.png"><img class="aligncenter wp-image-90" src="/wp-content/uploads/2015/04/wpmigration9.png" alt="wpmigration9" width="400" height="232" srcset="/wp-content/uploads/2015/04/wpmigration9.png 626w, /wp-content/uploads/2015/04/wpmigration9-300x174.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p><a href="/wp-content/uploads/2015/04/wpmigration10.png"><img class="aligncenter wp-image-92" src="/wp-content/uploads/2015/04/wpmigration10.png" alt="wpmigration10" width="400" height="202" srcset="/wp-content/uploads/2015/04/wpmigration10.png 522w, /wp-content/uploads/2015/04/wpmigration10-300x152.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p><a href="/wp-content/uploads/2015/04/wpmigration11.png"><img class="aligncenter wp-image-93" src="/wp-content/uploads/2015/04/wpmigration11.png" alt="wpmigration11" width="400" height="184" srcset="/wp-content/uploads/2015/04/wpmigration11.png 533w, /wp-content/uploads/2015/04/wpmigration11-300x138.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></p>

<p>Note that this plugin does have regular updates, and each update will reset your file upload limit. Because I use this plugin to import existing sites to my local development environment, and not as part of my regular workflow, it’s not much of a problem.</p>

<p> </p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
* Copyright (C) 2014 ServMask Inc.
*
* This program is free software: you can redistribute it &lt;strong&gt;and/or modify&lt;/strong&gt;
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program. If not, see &amp;lt;http://www.gnu.org/licenses/&amp;gt;.
*/</span>
</code></pre></div></div>
:ET